<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:c="jakarta.tags.core">

<h:head>
    <title>Ejemplo02 usando JSF con Jakarta EE 10</title>
    <meta charset="UTF-8"/>
</h:head>

<h:body>
    <h1>Hola desde JSF, </h1>
    <!-- 
    <h2>Ejercicio ampliado con bucles y condicionales</h2>

    <p>Nombre: <h:outputText value="#{helloBean.nombre}" /></p>
    <p>Edad: <h:outputText value="#{helloBean.edad}" /></p>

 Condicional: solo se muestra si edad > 18 -->
    <h:panelGroup rendered="#{helloBean.edad gt 18}">
        <p><b>El usuario es mayor de edad.</b></p>
    </h:panelGroup>

    <h:panelGroup rendered="#{helloBean.edad le 18}">
        <p><b>El usuario es menor de edad.</b></p>
    </h:panelGroup>
   
 <!-- Práctica 2: 
        * Añade aquí la sección para mostrar la lista de usuarios.
        * Comprueba si quieres primero que se muestra uno y después genera a todos.
        * Estudia como se publican aquí los elementos de un objeto dentro de una clase.
        * Utiliza la aproximación que prefieras para gestionar el total de pagos del usuario. por ejemplo, 
          puedes usar un bucle ui:repeat y variables, o crear una función dentro del objeto que calcule el total. 
   -->
    <h2>Tabla de usuarios (con h:dataTable):</h2>
    <h:dataTable value="#{helloBean.usuarios}" var="u" border="1">

        <h:column>
            <f:facet name="header">Nombre</f:facet>
            #{u.nombre}
        </h:column>

        <h:column>
            <f:facet name="header">Apellidos</f:facet>
            #{u.apellidos}
        </h:column>

        <h:column>
            <f:facet name="header">DNI</f:facet>
            #{u.dni}
        </h:column>

        <h:column>
            <f:facet name="header">Email</f:facet>
            #{u.email}
        </h:column>

        <h:column>
            <f:facet name="header">Edad</f:facet>
            #{u.edad}
        </h:column>

    </h:dataTable>

    
    <h2>Pagos mensuales por usuario:</h2>
    <ui:repeat value="#{helloBean.usuarios}" var="u">
    <h3>#{u.nombre} #{u.apellidos}</h3>

        <table border="1" cellpadding="5">
            <tr>
                <th>Mes</th>
                <th>Importe</th>
            </tr>

            <!-- Recorremos todos los meses -->
            <ui:repeat value="#{['enero','febrero','marzo','abril','mayo','junio','julio','agosto','septiembre','octubre','noviembre','diciembre']}" var="mes">
                <tr>
                    <td>#{mes}</td>
                    <td>
                        <!-- Si hay pago -->
                        <h:panelGroup rendered="#{u.pagos[mes] ne null}">
                            #{u.pagos[mes]} €
                        </h:panelGroup>

                        <!-- Si NO hay pago -->
                        <h:panelGroup rendered="#{u.pagos[mes] eq null}">
                            <span style="color:red; font-weight:bold;">NO PAGADO</span>
                        </h:panelGroup>
                    </td>
                </tr>
            </ui:repeat>

            <!-- Total anual -->
            <tr>
                <th>Total anual</th>
                <td>#{helloBean.calcularTotal(u)} €</td>
            </tr>
        </table>

        <!-- Mensaje de estado de pagos -->
        <h:panelGroup>
            <h:outputText value="El usuario no está al día con la cuota"
                        style="color:red; font-weight:bold;"
                        rendered="#{helloBean.calcularTotal(u) lt 100}" />
            <h:outputText value="El usuario está al corriente de pagos"
                        style="color:green; font-weight:bold;"
                        rendered="#{helloBean.calcularTotal(u) ge 100}" />
        </h:panelGroup>

        <br/>
    </ui:repeat>

    <h2>Lista de productos (con bucle ui:repeat):</h2>
    <ul>
        <ui:repeat value="#{helloBean.productos}" var="p">
            <li>
                #{p.nombre} - #{p.precio} €
                <!-- Condicional dentro del bucle -->
                <h:panelGroup rendered="#{p.precio lt 2.0}">
                    <span style="color:green;">(¡Oferta!)</span>
                </h:panelGroup>
            </li>
        </ui:repeat>
    </ul>

    <h2>Tabla de productos (con h:dataTable):</h2>
    <h:dataTable value="#{helloBean.productos}" var="p" border="1">
        <h:column>
            <f:facet name="header">Nombre</f:facet>
            #{p.nombre}
        </h:column>
        <h:column>
            <f:facet name="header">Precio</f:facet>
            #{p.precio} €
        </h:column>
    </h:dataTable>
</h:body>
</html>
